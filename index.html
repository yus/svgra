<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVGRA - Native SVG Editor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .app-container {
            display: flex;
            flex-direction: column;
            height: calc(100vh - 40px);
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
        }

        /* Header Styles */
        .app-header {
            background: linear-gradient(90deg, #4f46e5, #7c3aed);
            color: white;
            padding: 18px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .app-header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }

        .app-header h1::before {
            content: 'üé®';
            font-size: 1.6rem;
            filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2));
        }

        /* Floating Menu Styles */
        .floating-menu {
            position: relative;
            display: inline-block;
            z-index: 1000;
        }

        .menu-toggle {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.25);
            color: white;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            font-size: 1.8rem;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            backdrop-filter: blur(10px);
        }

        .menu-toggle:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-2px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .menu-toggle:active {
            transform: translateY(0) scale(0.98);
        }

        .menu-dropdown {
            position: absolute;
            top: calc(100% + 10px);
            right: 0;
            background: white;
            border-radius: 14px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3), 0 0 0 1px rgba(0, 0, 0, 0.05);
            min-width: 240px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-15px) scale(0.95);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .menu-dropdown.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0) scale(1);
        }

        .menu-item {
            width: 100%;
            padding: 14px 18px;
            text-align: left;
            background: none;
            border: none;
            cursor: pointer;
            color: #374151;
            font-size: 0.95rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(229, 231, 235, 0.5);
        }

        .menu-item:last-child {
            border-bottom: none;
        }

        .menu-item:hover {
            background: linear-gradient(90deg, #f8fafc, #ffffff);
            color: #4f46e5;
            padding-left: 22px;
        }

        .menu-item::before {
            font-size: 1.2rem;
        }

        .menu-divider {
            height: 1px;
            background: linear-gradient(90deg, transparent, #e5e7eb, transparent);
            margin: 8px 0;
        }

        /* Main Content Layout */
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
            min-height: 0;
        }

        @media (max-width: 768px) {
            .main-content {
                flex-direction: column;
            }
        }

        /* Panel Styles */
        .editor-panel, .preview-panel {
            flex: 1;
            padding: 24px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            min-width: 0;
        }

        .editor-panel {
            border-right: 1px solid #e5e7eb;
        }

        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 18px;
            padding-bottom: 14px;
            border-bottom: 2px solid #e5e7eb;
        }

        .panel-header h2 {
            font-size: 1.25rem;
            color: #1f2937;
            font-weight: 700;
            letter-spacing: -0.3px;
        }

        .panel-header .status {
            font-size: 0.85rem;
            color: #6b7280;
            background: #f3f4f6;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: 500;
        }

        /* Editor Container */
        .editor-container {
            flex: 1;
            border: 2px solid #d1d5db;
            border-radius: 12px;
            overflow: hidden;
            background: #f8fafc;
            transition: border-color 0.3s ease;
            position: relative;
        }

        .editor-container:focus-within {
            border-color: #4f46e5;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        #editor {
            width: 100%;
            height: 100%;
            padding: 20px;
            border: none;
            resize: none;
            font-family: 'JetBrains Mono', 'Fira Code', 'Cascadia Code', 'Consolas', monospace;
            font-size: 15px;
            line-height: 1.6;
            background: transparent;
            color: #1f2937;
            tab-size: 2;
            white-space: pre;
            overflow-wrap: normal;
            overflow-x: auto;
        }

        #editor:focus {
            outline: none;
        }

        /* Preview Container */
        #preview {
            flex: 1;
            border: 2px solid #d1d5db;
            border-radius: 12px;
            background: 
                linear-gradient(45deg, #f3f4f6 25%, transparent 25%),
                linear-gradient(-45deg, #f3f4f6 25%, transparent 25%),
                linear-gradient(45deg, transparent 75%, #f3f4f6 75%),
                linear-gradient(-45deg, transparent 75%, #f3f4f6 75%);
            background-size: 24px 24px;
            background-position: 0 0, 0 12px, 12px -12px, -12px 0px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: auto;
            padding: 25px;
            transition: border-color 0.3s ease;
        }

        #preview:focus-within {
            border-color: #10b981;
        }

        /* ViewBox Overlay */
        .viewbox-overlay {
            position: absolute;
            pointer-events: none;
            z-index: 10;
        }

        .viewbox-indicator {
            position: absolute;
            border: 3px dashed rgba(239, 68, 68, 0.6);
            background: rgba(239, 68, 68, 0.05);
            box-sizing: border-box;
        }

        .viewbox-label {
            position: absolute;
            font-size: 12px;
            color: #ef4444;
            background: white;
            padding: 4px 8px;
            border: 1px solid #ef4444;
            border-radius: 4px;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #10b981;
            color: white;
            padding: 14px 22px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
            z-index: 10000;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            background: #ef4444;
            box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3);
        }

        .toast.warning {
            background: #f59e0b;
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.3);
        }

        .toast::before {
            font-size: 1.2rem;
        }

        /* Mobile Responsiveness */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .app-container {
                height: calc(100vh - 20px);
                border-radius: 12px;
            }

            .app-header {
                padding: 15px 20px;
            }

            .app-header h1 {
                font-size: 1.4rem;
            }

            .menu-toggle {
                width: 40px;
                height: 40px;
                font-size: 1.5rem;
            }

            .editor-panel, .preview-panel {
                padding: 16px;
                min-height: 50vh;
            }

            .panel-header h2 {
                font-size: 1.1rem;
            }

            #editor {
                padding: 15px;
                font-size: 14px;
            }

            .menu-dropdown {
                position: fixed;
                top: auto;
                bottom: 80px;
                right: 20px;
                left: 20px;
                min-width: auto;
            }
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #a1a1a1;
        }

        /* Selection Styling */
        ::selection {
            background: rgba(79, 70, 229, 0.2);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>SVGRA - Native SVG Editor</h1>
            <div class="floating-menu">
                <button class="menu-toggle" id="menuToggle">‚ãÆ</button>
                <div class="menu-dropdown" id="menuDropdown">
                    <button class="menu-item" id="saveSVG">
                        üíæ Save SVG File
                    </button>
                    <button class="menu-item" id="savePNG">
                        üñºÔ∏è Export as PNG
                    </button>
                    <button class="menu-item" id="copyCode">
                        üìã Copy SVG Code
                    </button>
                    <button class="menu-item" id="shareLink">
                        üîó Create Shareable Link
                    </button>
                    <button class="menu-item" id="loadExample">
                        üß™ Load Example
                    </button>
                    <div class="menu-divider"></div>
                    <button class="menu-item" id="toggleViewBox">
                        üìê Show ViewBox Overlay
                    </button>
                    <button class="menu-item" id="toggleGrid">
                        üü∞ Hide Background Grid
                    </button>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Editor Panel -->
            <section class="editor-panel">
                <div class="panel-header">
                    <h2>SVG Code Editor</h2>
                    <span class="status" id="editorStatus">Ready</span>
                </div>
                <div class="editor-container">
                    <textarea id="editor" spellcheck="false" placeholder="Type your SVG code here..."></textarea>
                </div>
            </section>

            <!-- Preview Panel -->
            <section class="preview-panel">
                <div class="panel-header">
                    <h2>Live Preview</h2>
                    <span class="status" id="previewStatus">Valid SVG</span>
                </div>
                <div id="preview">
                    <!-- SVG will be rendered here -->
                </div>
            </section>
        </main>
    </div>

    <script>
        // ====== APP STATE ======
        const state = {
            showViewBoxOverlay: true,
            showBackgroundGrid: true,
            lastValidSVG: '',
            isEditorDirty: false
        };

        // ====== DOM ELEMENTS ======
        const editor = document.getElementById('editor');
        const preview = document.getElementById('preview');
        const menuToggle = document.getElementById('menuToggle');
        const menuDropdown = document.getElementById('menuDropdown');
        const editorStatus = document.getElementById('editorStatus');
        const previewStatus = document.getElementById('previewStatus');

        // ====== INITIAL SVG CONTENT ======
        const initialSVG = `<svg width="400" height="300" viewBox="0 0 400 300" xmlns="http://www.w3.org/2000/svg">
  <!-- Welcome to SVGRA - Native SVG Editor -->
  <!-- Try editing this code and watch the preview update in real-time! -->
  
  <!-- Background rectangle with gradient -->
  <defs>
    <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#3b82f6" stop-opacity="0.1"/>
      <stop offset="100%" stop-color="#8b5cf6" stop-opacity="0.1"/>
    </linearGradient>
    
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="2" dy="4" stdDeviation="3" flood-color="#4f46e5" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <!-- ViewBox boundary (matches viewBox="0 0 400 300") -->
  <rect x="0" y="0" width="400" height="300" fill="url(#bgGradient)" stroke="#d1d5db" stroke-width="1" stroke-dasharray="5,5"/>
  
  <!-- Main design elements -->
  <rect x="50" y="50" width="300" height="200" rx="20" fill="white" stroke="#4f46e5" stroke-width="3" filter="url(#shadow)"/>
  
  <circle cx="200" cy="150" r="80" fill="#ef4444" opacity="0.8" filter="url(#shadow)"/>
  
  <polygon points="200,70 250,170 150,170" fill="#10b981" opacity="0.9" filter="url(#shadow)"/>
  
  <!-- Text elements -->
  <text x="200" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" fill="#374151" font-weight="bold">
    SVGRA Editor
  </text>
  
  <text x="200" y="285" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" fill="#6b7280">
    Edit code ‚Ä¢ See live preview ‚Ä¢ Export freely
  </text>
  
  <!-- Coordinate markers -->
  <circle cx="0" cy="0" r="4" fill="#ef4444"/>
  <text x="10" y="15" font-family="monospace" font-size="10" fill="#ef4444">(0,0)</text>
  
  <circle cx="400" cy="300" r="4" fill="#10b981"/>
  <text x="330" y="295" font-family="monospace" font-size="10" fill="#10b981">(400,300)</text>
</svg>`;

        // ====== INITIALIZATION ======
        function init() {
            // Set initial editor content
            editor.value = initialSVG;
            state.lastValidSVG = initialSVG;
            
            // Setup event listeners
            setupEventListeners();
            
            // Initial render
            renderPreview();
            
            // Load from URL if present
            loadFromURL();
            
            console.log('SVGRA Editor initialized successfully!');
        }

        // ====== EVENT LISTENERS ======
        function setupEventListeners() {
            // Editor input
            editor.addEventListener('input', function() {
                state.isEditorDirty = true;
                editorStatus.textContent = 'Editing...';
                editorStatus.style.color = '#f59e0b';
                renderPreview();
            });
            
            // Tab key support
            editor.addEventListener('keydown', function(e) {
                if (e.key === 'Tab') {
                    e.preventDefault();
                    const start = this.selectionStart;
                    const end = this.selectionEnd;
                    const spaces = '  ';
                    this.value = this.value.substring(0, start) + spaces + this.value.substring(end);
                    this.selectionStart = this.selectionEnd = start + spaces.length;
                    renderPreview();
                }
            });
            
            // Menu toggle
            menuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                menuDropdown.classList.toggle('show');
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', function(e) {
                if (!menuToggle.contains(e.target) && !menuDropdown.contains(e.target)) {
                    menuDropdown.classList.remove('show');
                }
            });
            
            // Menu actions
            document.getElementById('saveSVG').addEventListener('click', saveSVG);
            document.getElementById('savePNG').addEventListener('click', exportPNG);
            document.getElementById('copyCode').addEventListener('click', copyCode);
            document.getElementById('shareLink').addEventListener('click', createShareLink);
            document.getElementById('loadExample').addEventListener('click', loadExample);
            document.getElementById('toggleViewBox').addEventListener('click', toggleViewBox);
            document.getElementById('toggleGrid').addEventListener('click', toggleGrid);
        }

        // ====== CORE RENDERING FUNCTION ======
        function renderPreview() {
            const svgCode = editor.value;
            
            // Clear preview
            preview.innerHTML = '';
            
            // Remove old viewBox overlay
            const oldOverlay = document.querySelector('.viewbox-overlay');
            if (oldOverlay) oldOverlay.remove();
            
            try {
                // Parse SVG
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgCode, 'image/svg+xml');
                
                // Check for parsing errors
                const error = svgDoc.querySelector('parsererror');
                if (error) {
                    preview.innerHTML = `<div style="color: #ef4444; padding: 20px; font-family: monospace; background: #fef2f2; border-radius: 8px;">
                        <strong>XML Error:</strong><br>${error.textContent}
                    </div>`;
                    previewStatus.textContent = 'Invalid XML';
                    previewStatus.style.color = '#ef4444';
                    return;
                }
                
                const svgElement = svgDoc.documentElement;
                if (!svgElement || svgElement.nodeName !== 'svg') {
                    throw new Error('Root element must be <svg>');
                }
                
                // Import and render SVG
                const importedSvg = document.importNode(svgElement, true);
                preview.appendChild(importedSvg);
                
                // Store valid SVG
                state.lastValidSVG = svgCode;
                state.isEditorDirty = false;
                
                // Update status
                editorStatus.textContent = 'Valid SVG';
                editorStatus.style.color = '#10b981';
                previewStatus.textContent = 'Rendered';
                previewStatus.style.color = '#10b981';
                
                // Add viewBox overlay if enabled
                if (state.showViewBoxOverlay) {
                    addViewBoxOverlay(importedSvg);
                }
                
                // Make elements interactive
                makeInteractive(importedSvg);
                
            } catch (err) {
                preview.innerHTML = `<div style="color: #ef4444; padding: 20px; font-family: monospace; background: #fef2f2; border-radius: 8px;">
                    <strong>Rendering Error:</strong><br>${err.message}
                </div>`;
                previewStatus.textContent = 'Error';
                previewStatus.style.color = '#ef4444';
            }
        }

        // ====== VIEWBOX OVERLAY ======
        function addViewBoxOverlay(svgElement) {
            const viewBox = svgElement.getAttribute('viewBox');
            if (!viewBox) return;
            
            const [x, y, width, height] = viewBox.split(' ').map(parseFloat);
            const svgRect = preview.getBoundingClientRect();
            const svgInnerRect = svgElement.getBoundingClientRect();
            
            // Calculate scale and position
            const scaleX = svgInnerRect.width / width;
            const scaleY = svgInnerRect.height / height;
            const offsetX = (svgRect.width - svgInnerRect.width) / 2;
            const offsetY = (svgRect.height - svgInnerRect.height) / 2;
            
            // Create overlay container
            const overlay = document.createElement('div');
            overlay.className = 'viewbox-overlay';
            overlay.style.width = `${svgRect.width}px`;
            overlay.style.height = `${svgRect.height}px`;
            
            // Create viewBox indicator
            const indicator = document.createElement('div');
            indicator.className = 'viewbox-indicator';
            indicator.style.left = `${offsetX}px`;
            indicator.style.top = `${offsetY}px`;
            indicator.style.width = `${svgInnerRect.width}px`;
            indicator.style.height = `${svgInnerRect.height}px`;
            
            // Create label
            const label = document.createElement('div');
            label.className = 'viewbox-label';
            label.textContent = `viewBox="${viewBox}"`;
            label.style.left = `${offsetX + 10}px`;
            label.style.top = `${offsetY - 30}px`;
            
            overlay.appendChild(indicator);
            overlay.appendChild(label);
            preview.appendChild(overlay);
        }

        // ====== INTERACTIVE FEATURES ======
        function makeInteractive(svgElement) {
            // Add click handlers to all elements
            const elements = svgElement.querySelectorAll('*');
            elements.forEach(el => {
                el.style.cursor = 'pointer';
                el.addEventListener('click', function(e) {
                    e.stopPropagation();
                    selectElement(this);
                });
            });
            
            // Add click handler to SVG root for deselection
            svgElement.addEventListener('click', function(e) {
                if (e.target === this) {
                    clearSelection();
                }
            });
        }
        
        function selectElement(element) {
            // Remove previous selection
            clearSelection();
            
            // Highlight selected element
            element.style.outline = '2px solid #4f46e5';
            element.style.outlineOffset = '2px';
            
            // Show toast with element info
            const tag = element.tagName.toLowerCase();
            const id = element.id ? `#${element.id}` : '';
            showToast(`Selected: &lt;${tag}${id}&gt;`, 'info');
        }
        
        function clearSelection() {
            const selected = preview.querySelector('[style*="outline: 2px solid"]');
            if (selected) {
                selected.style.outline = '';
            }
        }

        // ====== MENU ACTIONS ======
        function saveSVG() {
            const svgCode = editor.value;
            const blob = new Blob([svgCode], { type: 'image/svg+xml;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `svgra-design-${Date.now()}.svg`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            showToast('üíæ SVG saved successfully!');
            menuDropdown.classList.remove('show');
        }
        
        function exportPNG() {
            const svgElement = preview.querySelector('svg');
            if (!svgElement) {
                showToast('No SVG to export', 'error');
                return;
            }
            
            const svgData = new XMLSerializer().serializeToString(svgElement);
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const img = new Image();
            
            img.onload = function() {
                // Set canvas dimensions
                canvas.width = img.width;
                canvas.height = img.height;
                
                // Draw white background
                ctx.fillStyle = 'white';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Draw SVG
                ctx.drawImage(img, 0, 0);
                
                // Create download link
                const pngUrl = canvas.toDataURL('image/png');
                const a = document.createElement('a');
                a.href = pngUrl;
                a.download = `svgra-export-${Date.now()}.png`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                showToast('üñºÔ∏è PNG exported successfully!');
            };
            
            img.onerror = function() {
                showToast('Failed to export PNG', 'error');
            };
            
            img.src = 'data:image/svg+xml;base64,' + btoa(unescape(encodeURIComponent(svgData)));
            menuDropdown.classList.remove('show');
        }
        
        function copyCode() {
            navigator.clipboard.writeText(editor.value)
                .then(() => showToast('üìã SVG code copied to clipboard!'))
                .catch(() => showToast('Failed to copy', 'error'));
            menuDropdown.classList.remove('show');
        }
        
        function createShareLink() {
            const svgCode = encodeURIComponent(editor.value);
            const currentUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${currentUrl}?svg=${svgCode}`;
            
            // Try to use Web Share API first
            if (navigator.share) {
                navigator.share({
                    title: 'My SVG Design',
                    text: 'Check out this SVG design I made with SVGRA!',
                    url: shareUrl
                });
            } else {
                // Fallback to clipboard
                navigator.clipboard.writeText(shareUrl)
                    .then(() => showToast('üîó Shareable link copied to clipboard!'))
                    .catch(() => showToast('Failed to copy link', 'error'));
            }
            menuDropdown.classList.remove('show');
        }
        
        function loadExample() {
            editor.value = initialSVG;
            renderPreview();
            showToast('üß™ Example loaded!');
            menuDropdown.classList.remove('show');
        }
        
        function toggleViewBox() {
            state.showViewBoxOverlay = !state.showViewBoxOverlay;
            const btn = document.getElementById('toggleViewBox');
            btn.innerHTML = state.showViewBoxOverlay ? 
                'üìê Hide ViewBox Overlay' : 'üìê Show ViewBox Overlay';
            renderPreview();
            menuDropdown.classList.remove('show');
        }
        
        function toggleGrid() {
            state.showBackgroundGrid = !state.showBackgroundGrid;
            const btn = document.getElementById('toggleGrid');
            btn.innerHTML = state.showBackgroundGrid ? 
                'üü∞ Hide Background Grid' : 'üü∞ Show Background Grid';
            
            if (state.showBackgroundGrid) {
                preview.style.background = `
                    linear-gradient(45deg, #f3f4f6 25%, transparent 25%),
                    linear-gradient(-45deg, #f3f4f6 25%, transparent 25%),
                    linear-gradient(45deg, transparent 75%, #f3f4f6 75%),
                    linear-gradient(-45deg, transparent 75%, #f3f4f6 75%)
                `;
                preview.style.backgroundSize = '24px 24px';
                preview.style.backgroundPosition = '0 0, 0 12px, 12px -12px, -12px 0px';
            } else {
                preview.style.background = '#ffffff';
            }
            menuDropdown.classList.remove('show');
        }

        // ====== URL LOADING ======
        function loadFromURL() {
            const urlParams = new URLSearchParams(window.location.search);
            const svgParam = urlParams.get('svg');
            
            if (svgParam) {
                try {
                    const decodedSVG = decodeURIComponent(svgParam);
                    editor.value = decodedSVG;
                    renderPreview();
                    showToast('üìÇ Loaded from URL', 'info');
                } catch (err) {
                    showToast('Failed to load from URL', 'error');
                }
            }
        }

        // ====== TOAST NOTIFICATIONS ======
        function showToast(message, type = 'success') {
            // Remove existing toast
            const existingToast = document.querySelector('.toast');
            if (existingToast) existingToast.remove();
            
            // Create new toast
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = message;
            
            // Add icon based on type
            let icon = '‚úÖ';
            if (type === 'error') icon = '‚ùå';
            if (type === 'warning') icon = '‚ö†Ô∏è';
            if (type === 'info') icon = '‚ÑπÔ∏è';
            
            toast.innerHTML = `${icon} ${message}`;
            
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => toast.classList.add('show'), 10);
            
            // Remove after delay
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        document.body.removeChild(toast);
                    }
                }, 400);
            }, 3000);
        }

        // ====== INITIALIZE APP ======
        // Set up beforeunload warning
        window.addEventListener('beforeunload', function(e) {
            if (state.isEditorDirty) {
                e.preventDefault();
                e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
            }
        });

        // Initialize when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
